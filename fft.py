import numpy as np

# samples = {"1385326568189":{"x":[0.7604859940316527,0.7604859940316527,0.7604859940316527,0.7604859940316527,0.7604859940316527,-0.01287832669582567,0.0000912763806534258,0.010375115128175821,-0.0038428492592545807,-0.0019472419168901978,0.013580984797666314,-0.009712086925469338,-0.009750980464019812,-0.02130127685141051,-0.0015481625935230112,-0.007312568056912277,0.000058967784082778955,0.010008546838106121,0.011494460847193841,0.012139435086690355],"y":[-0.9408222490463405,-0.9408222490463405,-0.9408222490463405,-0.9408222490463405,-0.9408222490463405,-0.016078505268401933,0.006453748995691421,0.018135043930920074,-0.012540438794257352,0.002425974477698037,0.013097225576936034,0.004808566471395897,-0.00547200452441175,-0.008398518396404688,0.0011346772886514371,-0.008599698957733926,0.0027606686292929224,0.01729796406076057,0.009366780619136988,-0.006878496621738304],"z":[1.463181039482355,1.463181039482355,1.463181039482355,1.463181039482355,1.463181039482355,0.06555018440559505,0.05790384350405074,0.0594895828921115,0.040064664689078926,0.02595271253657993,0.02583781745263841,0.047107673969189634,0.05533895688552875,0.02166491339887725,0.03469554343794007,0.037394582396722394,0.03199957550236722,0.03289660654048202,0.02600343351024203,0.026746452163578942]},"1385326569192":{"x":[-0.007588720971281873,0.02793547700176714,0.0035504262009184457,0.019234245335985906,0.031190658855834042,0.031190658855834042,-0.000755942780519399,0.001251623764722899,0.0006579171324574418,0.019933687425788955,0.0012589462713644025,0.0017089863137000065,0.009598226171277929,-0.01296745943413698,0.01261200162654859,-0.009903086302790324,0.008672487916020327,-0.0024875464951706816,0.006785485146864084,-0.01864971202985616],"y":[0.000977201226372199,0.014725474091095384,-0.0037055131584085754,-0.01248936505250167,0.01671132898744545,0.01671132898744545,0.007660234142045374,0.005247854079448734,-0.006310117582677049,0.012529184464592252,-0.011219784649746725,-0.0030654611183796076,0.00008364960796357082,-0.012270367989980149,0.02312907451717183,0.0028459115000092424,0.011413382409530458,-0.009742149845237144,-0.00738693362599879,0.006478299485880416],"z":[0.036910785501729694,0.021652108716231303,0.030180315052799413,0.005784961768233916,0.02613009209721349,0.02613009209721349,0.010868126234441297,0.024184291791683063,-0.0010748149548944637,0.026015893416304607,0.006594661011945572,0.011520957270119106,0.02034931445539696,0.0009058540935038763,0.01407844489183044,0.023663181393872947,0.01333935349493986,0.010966966374369802,0.01964980386693496,-0.00637174753859872]},"1385326570192":{"x":[0.003624460407742299,0.0062862577872991095,-0.002608207739140198,-0.00538279872086423,-0.013732372542162192,0.0009505100817383209,0.016167205323517553,0.012716636753024067,-0.004465893653089006,-0.010089967769064241,-0.010089967769064241,0.004042769445259182,-0.014064955222595016,-0.007177433331718202,-0.005954036437292234,-0.019714932391862384,0.01285468210040126,-0.010191673436225391,0.022907195944397243,-0.0050232715221121904],"y":[0.004644132301070203,0.007938939773105084,-0.009000685540636186,-0.011053674260154366,0.00564028061327117,0.0014561279380664927,0.007486628857519826,-0.00026307905339981516,-0.0019562440677313134,-0.0008608387013682658,-0.0008608387013682658,-0.010946380244067404,0.0011211864777716982,0.00536208244310983,0.0016360767692327497,-0.016744473205221582,0.004383328223704302,-0.009400622952412232,-0.0013843263594077143,0.00881467800308601],"z":[-0.012063740643620258,-0.008768911765754455,0.009940036762715317,0.034344606541842224,0.01040621123604942,-0.008154779618271277,0.0033701508594778714,-0.01054792696990189,0.02701364031595876,-0.0030586132503623957,-0.0030586132503623957,0.024174959991045762,0.011304730978352016,-0.016377917473239356,-0.0006506048292620107,-0.004854660360646084,-0.01308850227271905,-0.003673499739327235,-0.024933290377946102,-0.024640072735166177]},"1385326571193":{"x":[-0.021702315949951298,-0.003983002652860886,-0.0072291732229321495,-0.002983997661170724,-0.021649176973628344,0.013020999127614776,-0.011781321814423427,-0.003479526378563605,-0.019767007355683017,-0.015388417812122497,-0.00828885375589598,0.0064512573569722,0.00026429420890663097,-0.01513226251041051,-0.017709464046166974,-0.011845832709776004,-0.011845832709776004,0.0006493711398732557,-0.009796662219671997,0.002464892276190221],"y":[0.004038542507179954,-0.008058266149458359,0.001724978039159032,-0.0034069965735368892,-0.011600932879373431,0.0014704893954425643,-0.0067286169893835904,0.005851106927424552,0.02552059331318596,0.005851310710934921,-0.006062058822452672,-0.007053860609332332,-0.006425959660578519,-0.01352122314266744,-0.010087653656036127,0.017293472832022233,0.017293472832022233,-0.0032453936811143646,0.0057191813644021745,-0.022249076812248674],"z":[-0.004556406068555952,-0.007414478078405955,-0.016089704799139872,-0.023724220548861193,-0.0024754028245835796,-0.006977924137667286,-0.009517698576996917,0.016531569098413454,-0.0032127126855193634,-0.0189146100437385,-0.01486854267346207,-0.0023052334613319543,-0.018919714335474416,0.007406057309932657,-0.009048562107485485,-0.00872002712697431,-0.00872002712697431,0.012356627209548604,-0.012023154046549462,0.005620285854724352]},"1385326572193":{"x":[-0.03401695233992068,0.0032770951458864143,-0.0003045378667278783,-0.0024555008246374198,-0.0137681025843136,-0.007963529650022973,0.004184320496919099,-0.009332423404275323,-0.022791223148221615,0.0010787568386585917,-0.006794054899920593,-0.005566127960849553,0.008165152027702424,-0.01860132571881986,-0.030069054964359382,-0.021220619680499656,0.0026367063207842875,-0.013884967004699865,-0.028580037966021335,-0.01112963013977278],"y":[0.007247719234842224,-0.003642293177366082,0.01047585724753444,-0.006836847153809503,0.0011479915727788466,0.0044561177528128606,0.0019098275212563749,-0.01288239323287853,-0.013980021452077197,0.0011691246934140507,0.0007216622698852006,-0.0012241331123041164,0.002632636358798481,-0.011157730572961736,0.015227295266545843,-0.0003790560950652434,-0.0014607123535221034,0.009915063293307321,0.00555232605189376,0.0054750350192480255],"z":[0.01668822895635967,-0.018776471081527416,0.00591378034625086,0.005177974601701134,0.005177998576231766,0.007711843314985162,-0.011896646156627683,0.004409580620157066,0.006499159039996448,0.008308567099118954,-0.0008293746986139012,0.004123308455983351,0.007110890309483511,0.009207630264115868,-0.018015182694204847,-0.0030301783153889117,0.0031061541737828517,-0.010353762954537523,0.011497140286403008,-0.013953878938889828]},"1385326573193":{"x":[-0.015769312596711098,-0.02392850409944076,-0.02392850409944076,-0.025711569857620634,-0.008230077910763793,0.0009920841297895095,-0.017044654878327854,-0.02303166029099375,-0.01551331712520332,-0.017717207819561008,-0.00956525434179348,-0.026258269071124957,-0.02637230792182963,0.008036119962198426,-0.009752184898772975,-0.004053132150713645,-0.014571417182189178,-0.00591556359467213,-0.002451973999934853,-0.004785256377756013],"y":[-0.012265772871609078,0.00022116408181482256,0.00022116408181482256,-0.009516520970885175,-0.019121385803859445,-0.005394379560803645,-0.01185134685182129,-0.009527388283127219,0.00630364046365139,-0.007726669278892222,0.007808361921197502,0.0011692623329068736,0.026684867302607742,0.007361202104765106,-0.00009762310249238907,-0.03043554790590424,0.018992760163731873,-0.009380934154542046,-0.016941043806803644,-0.010961123438761568],"z":[-0.003930726759640674,-0.007966683442445355,-0.007966683442445355,0.007897371932744863,-0.0046925714131561104,0.003699239537482208,-0.004834115900361212,-0.005870847099288949,-0.012619322991545777,-0.00873237229778315,0.005347846709314035,-0.004530533268838189,0.008200795304885832,0.021527612403593955,0.023041471582243685,0.010474664229224436,0.002697454071060929,-0.01422910426725284,0.002076722791315842,-0.020831702561303973]},"1385326574194":{"x":[-0.008452864090769435,-0.012374161724594887,-0.013596480335964587,-0.00479130480934109,-0.007141592550068162,-0.007141592550068162,-0.001636024110888684,-0.013271214453951687,-0.013661222985113271,-0.02097566390952561,-0.009614499169355258,-0.007967701218352885,-0.012864297028828877,0.002251064579130616,-0.013682660782075253,0.013871059493644861,-0.0091956190242694,0.0030776553067276835,-0.008673168906854697,-0.021412888566299807],"y":[0.013505629422958009,-0.010803865359193877,-0.015600736255396623,0.01805026314074057,0.0007696054088686651,0.0007696054088686651,-0.005087269248344819,-0.0033302278431656305,0.003914397820991871,0.013961150071537122,-0.01526445578902494,0.02790406808335101,0.0037360843953079892,-0.01280650927685201,-0.0009654679055638553,-0.006518379192874999,-0.015133447537210304,0.006262668561624014,0.00686402456756914,0.0036145943175652064],"z":[0.004485219978888926,0.00012298878023743782,-0.01799649169346667,-0.005581036693969508,-0.01453629791974672,-0.01453629791974672,-0.018419633025961227,-0.000027656534229777208,0.015841466800757917,-0.01782708880166756,-0.0061548111440672066,-0.002850853963663394,-0.0010372111176569887,-0.011492077093862463,0.02844177113964688,0.019334114097442942,-0.011488940996926976,0.007360925826840684,-0.012845771566516485,-0.0080556706211064]},"1385326575194":{"x":[-0.006079994054653798,-0.004400501122913556,0.011733017701777862,-0.023500727691024074,-0.0020253958899331334,-0.006835446356234024,-0.02062975709828315,-0.03206944413449382,0.004902330860696384,0.0048371846402820665,0.0048371846402820665,-0.01983103305220138,-0.008623735137158655,-0.01689454463382135,0.005473974431678652,-0.019082301610708237,-0.02118239286222961,0.0018048293518884747,-0.00707682478474453,-0.009099416082710376],"y":[-0.0018368060956461703,-0.012351059410220477,-0.010041482134972466,0.00261854903876374,-0.005736412772882613,-0.005376450036824098,0.007444008991922601,-0.008533129106857813,0.00288240986878518,-0.0022537634262931533,-0.0022537634262931533,0.010360772650636499,-0.008395060355772147,-0.005721102180963498,0.012401039456721627,-0.003899966580606997,-0.01099103566147969,-0.008763478109633432,-0.007387954826839268,-0.004450010811956599],"z":[0.01902325690833968,-0.003410970637400169,-0.007166943903744686,0.022770132411131634,0.001666755320697848,0.001651734135612787,-0.012559970045211958,-0.019591833451867567,-0.006571497619600268,0.0016671647428905998,0.0016671647428905998,0.00750483066366869,-0.01269910680455505,0.005427989569460624,-0.006404578945832327,-0.0012999742566687927,-0.004751259066264901,0.014691176812560297,-0.01179206697072368,-0.0053527957374230025]}}

def combined_fft(samples): 

	f_s = 20.0 # hz

	# list of all recorded samples from the session to be charted on heatmap
	all_recorded_samples = []

	for timestamp, sample in samples.iteritems():
		x = sample["x"]
		fft_x = np.fft.fft(x)
		n = len(fft_x)
		freq = np.fft.fftfreq(n, 1/f_s)
		# print "freq:", freq

		#Calculate absolute value of fft_x
		fft_x_abs = np.abs(fft_x)

		#Take first half of FFT array  + 1 to access 10th element?
		half_n = np.ceil(n/2.0) + 1
		freq_half = freq[:half_n]
		fft_x_half = fft_x_abs[:half_n]
		# print "freq_half", freq_half
		# print "fft_half", fft_x_half
		# Square magnitude of FFT to find PSD
		PSD_x_total = np.power(fft_x_half, 2)

		y = sample["y"]
		fft_y = np.fft.fft(y)
		n = len(fft_y)
		freq = np.fft.fftfreq(n, 1/f_s)
		# print "freq:", freq

		#Calculate absolute value of fft_y
		fft_y_abs = np.abs(fft_y)

		#Take first half of FFT array  + 1 to access 10th element?
		half_n = np.ceil(n/2.0) + 1
		freq_half = freq[:half_n]
		fft_y_half = fft_y_abs[:half_n]
		# print "freq_half", freq_half
		# print "fft_half", fft_y_half
		# Square magnitude of FFT to find PSD
		PSD_y_total = np.power(fft_y_half, 2)

		z = sample["z"]
		fft_z = np.fft.fft(z)
		n = len(fft_z)
		freq = np.fft.fftfreq(n, 1/f_s)
		# print "freq:", freq

		#Calculate absolute value of fft_z
		fft_z_abs = np.abs(fft_z)

		#Take first half of FFT array  + 1 to access 10th element?
		half_n = np.ceil(n/2.0) + 1
		freq_half = freq[:half_n]
		fft_z_half = fft_z_abs[:half_n]
		# print "freq_half", freq_half
		# print "fft_half", fft_z_half
		# Square magnitude of FFT to find PSD
		PSD_z_total = np.power(fft_z_half, 2)


		# Combine PSDs for x, y, and z axes
		PSD_total_1hz = fft_x_half[1] + fft_y_half[1] + fft_z_half[1]
		PSD_total_3hz = fft_x_half[3] + fft_y_half[3] + fft_z_half[3]
		PSD_total_6hz = fft_x_half[6] + fft_y_half[6] + fft_z_half[6]
		PSD_total_10hz = fft_x_half[10] + fft_y_half[10] + fft_z_half[10]

	#Create dictionary of timestamp and total PSDs for each one second interval
		PSD_one_sec_sample_dict = {}

		PSD_one_sec_sample_dict["timestamp"]= timestamp
		PSD_one_sec_sample_dict["data"] = [PSD_total_1hz, PSD_total_3hz, PSD_total_6hz, PSD_total_10hz]

		#Append dictionary to master list of samples for charting
		all_recorded_samples.append(PSD_one_sec_sample_dict)

	print all_recorded_samples

	return all_recorded_samples